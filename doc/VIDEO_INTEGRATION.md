# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ VK/Rutube –≤ –±–ª–æ–∫–∏ Media –∏ Button

**–î–∞—Ç–∞:** 05 –¥–µ–∫–∞–±—Ä—è 2024  
**–í–µ—Ä—Å–∏—è –ø–ª–∞–≥–∏–Ω–∞:** 0.1.0

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π](#–æ–±–∑–æ—Ä-–∏–∑–º–µ–Ω–µ–Ω–∏–π)
2. [–ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —É—Ç–∏–ª–∏—Ç—ã](#–Ω–æ–≤—ã–µ-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-–∏-—É—Ç–∏–ª–∏—Ç—ã)
3. [–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã](#–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ-—Ñ–∞–π–ª—ã)
4. [API –∏ —Ñ—É–Ω–∫—Ü–∏–∏](#api-–∏-—Ñ—É–Ω–∫—Ü–∏–∏)
5. [–†–µ—à—ë–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã](#—Ä–µ—à—ë–Ω–Ω—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã)
6. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

---

## –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –û—Å–Ω–æ–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–µ—Ä–æ–≤** –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–∏–ø–∞ –≤–∏–¥–µ–æ –≤ Media –±–ª–æ–∫–µ
2. **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** `VideoURLControl` –¥–ª—è –≤–≤–æ–¥–∞ –≤–∏–¥–µ–æ URL
3. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä—Å–µ—Ä—ã** URL –¥–ª—è –≤—Å–µ—Ö –≤–∏–¥–µ–æ-–ø–ª–∞—Ç—Ñ–æ—Ä–º
4. **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–∞—è —Ä–∞–±–æ—Ç–∞** Media –∏ Button –±–ª–æ–∫–æ–≤ —Å –≤–∏–¥–µ–æ
5. **–§–∏–∫—Å –ø—Ä–æ–±–ª–µ–º—ã** —Å `target="_blank"` —É GLightbox —Å—Å—ã–ª–æ–∫

### –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –±–ª–æ–∫–∏

- **Media Block** (`codeweber-blocks/media`)
- **Button Block** (`codeweber-blocks/button`)

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

- ‚úÖ **VK Video** (vkvideo.ru)
- ‚úÖ **Rutube** (rutube.ru)
- ‚úÖ **YouTube** (youtube.com)
- ‚úÖ **Vimeo** (vimeo.com)

---

## –ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —É—Ç–∏–ª–∏—Ç—ã

### 1. `VideoURLControl` Component

**–ü—É—Ç—å:** `src/components/video-url/VideoURLControl.js`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –≤–≤–æ–¥–∞ URL –≤–∏–¥–µ–æ —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–æ–π –ø–æ—Å—Ç–µ—Ä–∞.

**Props:**

| Prop | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|--------------|--------------|----------|
| `videoType` | `string` | –î–∞ | - | –¢–∏–ø –≤–∏–¥–µ–æ: 'vk', 'rutube', 'youtube', 'vimeo' |
| `value` | `string` | –î–∞ | - | –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ URL |
| `onChange` | `function` | –î–∞ | - | Callback –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ URL |
| `autoloadPoster` | `boolean` | –ù–µ—Ç | `false` | –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É –ø–æ—Å—Ç–µ—Ä–∞ |
| `onPosterLoad` | `function` | –ù–µ—Ç | - | Callback —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ—Å—Ç–µ—Ä–∞ `{url, width, height}` |
| `multiline` | `boolean` | –ù–µ—Ç | `false` | –ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π –≤–≤–æ–¥ (TextareaControl) |
| `enhanceQuality` | `boolean` | –ù–µ—Ç | `false` | –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞—á–µ—Å—Ç–≤–∞ (hd=2 –¥–ª—è VK) |
| `forLightbox` | `boolean` | –ù–µ—Ç | `false` | –î–æ–±–∞–≤–∏—Ç—å autoplay=1 –¥–ª—è –ª–∞–π—Ç–±–æ–∫—Å–∞ |

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```jsx
import VideoURLControl from '../../components/video-url/VideoURLControl';

<VideoURLControl
    videoType="vk"
    value={videoVkId}
    onChange={(value) => setAttributes({ videoVkId: value })}
    autoloadPoster={true}
    onPosterLoad={(posterData) => {
        setAttributes({
            videoPoster: {
                url: posterData.url,
                alt: 'Video poster'
            }
        });
    }}
    enhanceQuality={true}
    forLightbox={true}
/>
```

---

### 2. `videoUrlParsers.js` Utilities

**–ü—É—Ç—å:** `src/utilities/videoUrlParsers.js`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ URL –≤–∏–¥–µ–æ —Å —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º.

#### –§—É–Ω–∫—Ü–∏–∏:

##### `parseVKVideoURL(url, forLightbox = false)`

–ü–∞—Ä—Å–∏—Ç VK Video URL –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç embed URL.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `url` (string) - URL –∏–ª–∏ iframe –∫–æ–¥ VK Video
- `forLightbox` (boolean) - –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ª–∞–π—Ç–±–æ–∫—Å–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `string` - Embed URL

**–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç—ã:**
- iframe –∫–æ–¥: `<iframe src="..."></iframe>`
- –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞: `https://vkvideo.ru/video-123456_789012`
- Embed URL: `https://vkvideo.ru/video_ext.php?oid=-123&id=456`
- ID —Ñ–æ—Ä–º–∞—Ç: `-123456_789012`
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `oid=-123&id=456`

**–î–æ–±–∞–≤–ª—è–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (forLightbox=true):**
- `autoplay=1` - –∞–≤—Ç–æ–ø–ª–µ–π
- `hd=2` - HD –∫–∞—á–µ—Å—Ç–≤–æ
- `allowFullscreen=true` - –ø–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω
- `fullscreen=true` - –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º

**–ü—Ä–∏–º–µ—Ä:**

```javascript
import { parseVKVideoURL } from '../utilities/videoUrlParsers';

const embedUrl = parseVKVideoURL(
    'https://vkvideo.ru/video-82217805_456243357',
    true
);
// –†–µ–∑—É–ª—å—Ç–∞—Ç: 'https://vkvideo.ru/video_ext.php?oid=-82217805&id=456243357&hd=2&autoplay=1&allowFullscreen=true&fullscreen=true'
```

##### `parseRutubeVideoURL(url, forLightbox = false)`

–ü–∞—Ä—Å–∏—Ç Rutube URL –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç embed URL.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `url` (string) - URL –∏–ª–∏ iframe –∫–æ–¥ Rutube
- `forLightbox` (boolean) - –î–æ–±–∞–≤–∏—Ç—å autoplay=1

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `string` - Embed URL

**–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç—ã:**
- iframe –∫–æ–¥: `<iframe src="..."></iframe>`
- Embed URL: `https://rutube.ru/play/embed/VIDEO_ID`
- –û–±—ã—á–Ω–∞—è —Å—Å—ã–ª–∫–∞: `https://rutube.ru/video/VIDEO_ID`
- ID: `VIDEO_ID`

**–ü—Ä–∏–º–µ—Ä:**

```javascript
import { parseRutubeVideoURL } from '../utilities/videoUrlParsers';

const embedUrl = parseRutubeVideoURL(
    'https://rutube.ru/video/699bbd7d7cd0e8f5292ce8bdc5bf3264',
    true
);
// –†–µ–∑—É–ª—å—Ç–∞—Ç: 'https://rutube.ru/play/embed/699bbd7d7cd0e8f5292ce8bdc5bf3264?autoplay=1'
```

##### `parseYouTubeVideoURL(url)`

–ò–∑–≤–ª–µ–∫–∞–µ—Ç YouTube video ID.

**–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç—ã:**
- `https://www.youtube.com/watch?v=VIDEO_ID`
- `https://youtu.be/VIDEO_ID`
- `https://www.youtube.com/embed/VIDEO_ID`

##### `parseVimeoVideoURL(url)`

–ò–∑–≤–ª–µ–∫–∞–µ—Ç Vimeo video ID.

**–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç—ã:**
- `https://vimeo.com/VIDEO_ID`
- `https://player.vimeo.com/video/VIDEO_ID`

---

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Media Block

#### 1. `src/blocks/media/controls/MediaControl.js`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

- ‚úÖ –ó–∞–º–µ–Ω—ë–Ω `TextareaControl` –Ω–∞ `VideoURLControl` –¥–ª—è VK –∏ Rutube
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–µ—Ä–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `videoType`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–µ—Ä–∞..." —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
- ‚úÖ Margin-bottom 15px –¥–ª—è –∫–Ω–æ–ø–∫–∏ "Auto-load Poster" –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ `handleVKIDChange` –∏ `handleRutubeIDChange`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `videoUrlParsers.js` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ URL

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

```javascript
// –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–µ—Ä–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–∏–ø–∞ –≤–∏–¥–µ–æ
useEffect(() => {
    if ((videoType === 'vk' || videoType === 'rutube') && 
        !isLoadingPoster) {
        handleAutoLoadPoster();
    }
}, [videoType, videoVkId, videoRutubeId]);

// –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
{isLoadingPoster && (
    <div style={{ 
        display: 'flex', 
        alignItems: 'center', 
        gap: '8px',
        marginBottom: '15px'
    }}>
        <span className="spinner" />
        <span>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–µ—Ä–∞...</span>
    </div>
)}
```

#### 2. `src/blocks/media/style.scss`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `aspect-ratio: 16/9` **—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ—Å—Ç–µ—Ä–æ–≤ –≤–∏–¥–µ–æ**
- ‚úÖ –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –≤—ã—Å–æ—Ç—ã –≤—Å–µ—Ö –ø–æ—Å—Ç–µ—Ä–æ–≤ –≤–∏–¥–µ–æ
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Å–µ–ª–µ–∫—Ç–æ—Ä `:has(.video-play-btn)` –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –∫ –≤–∏–¥–µ–æ

```scss
figure {
    // –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¢–û–õ–¨–ö–û –∫ –≤–∏–¥–µ–æ (–∫–æ–≥–¥–∞ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ play)
    &:has(.video-play-btn) a > img {
        width: 100%;
        height: auto;
        object-fit: cover;
        aspect-ratio: 16 / 9; // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –¥–ª—è –≤–∏–¥–µ–æ
        display: block;
    }
}
```

**–í–∞–∂–Ω–æ:** –°—Ç–∏–ª–∏ –ù–ï –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ –æ–±—ã—á–Ω—ã–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º (—Ç–∏–ø "Image" –≤ Media –±–ª–æ–∫–µ).

#### 3. `src/blocks/media/editor.scss`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ CSS –∞–Ω–∏–º–∞—Ü–∏—è —Å–ø–∏–Ω–Ω–µ—Ä–∞

```scss
@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

.spinner {
    animation: spin 1s linear infinite;
    // ...
}
```

---

### Button Block

#### 1. `src/blocks/button/save.js`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `generateVideoId()` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö ID
- ‚úÖ –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–∫—Ä—ã—Ç–æ–≥–æ `<div>` —Å iframe –¥–ª—è –≤–∏–¥–µ–æ
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ `href` –Ω–∞ —è–∫–æ—Ä–Ω—É—é —Å—Å—ã–ª–∫—É `#video-xxx` –¥–ª—è –≤–∏–¥–µ–æ
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ `data-glightbox` –Ω–∞ `"width: auto;"` –¥–ª—è –≤–∏–¥–µ–æ
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ (–±–µ–∑ `useBlockProps.save()` –Ω–∞ `<a>`)
- ‚úÖ –£–±—Ä–∞–Ω `target="_blank"` –¥–ª—è GLightbox/–≤–∏–¥–µ–æ —Å—Å—ã–ª–æ–∫

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ã–≤–æ–¥–∞ –¥–ª—è –≤–∏–¥–µ–æ:**

```jsx
// –°–∫—Ä—ã—Ç—ã–π iframe
<div id="vkvideo-1234567890-abc123" style={{ display: 'none' }}>
    <iframe
        src="https://vkvideo.ru/video_ext.php?..."
        allow="autoplay; encrypted-media; fullscreen; picture-in-picture; clipboard-write;"
        frameBorder="0"
        allowFullScreen
        style={{ width: '100%', height: '100%', aspectRatio: '16/9' }}
    />
</div>

// –°—Å—ã–ª–∫–∞ –Ω–∞ —è–∫–æ—Ä—å
<a 
    href="#vkvideo-1234567890-abc123" 
    className="btn ..." 
    data-glightbox="width: auto;"
>
    Button Content
</a>
```

**–õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ:**

```javascript
const isVideoLink = LinkType === 'vkvideo' || LinkType === 'rutube' || 
                    LinkType === 'youtube' || LinkType === 'vimeo' ||
                    (hasGlightbox && DataGlightbox.includes('type: iframe'));
```

#### 2. `src/blocks/button/edit.js`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

- ‚úÖ –£–±—Ä–∞–Ω `data-glightbox` –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ (—Ç–æ–ª—å–∫–æ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `event.stopPropagation()` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–ª–∏–∫–∞ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
- ‚úÖ `href="#"` –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –¥–ª—è –≤–∏–¥–µ–æ-–∫–Ω–æ–ø–æ–∫

---

### Utilities

#### `src/utilities/link_type.js`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è `VideoURLControl` –¥–ª—è YouTube, Vimeo, Rutube, VK
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω `handleLinkTypeChange` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ `DataGlightbox`
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω—ã `handleRutubeIDChange` –∏ `handleVKIDChange` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ä—Å–µ—Ä–æ–≤

**–ü—Ä–∏–º–µ—Ä –¥–ª—è VK:**

```javascript
<VideoURLControl
    videoType="vk"
    value={VKID}
    onChange={handleVKIDChange}
    multiline={false}
    enhanceQuality={true}
    forLightbox={true}
/>
```

---

### Backend (PHP)

#### 1. `inc/VideoThumbnailAPI.php`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

- ‚úÖ –£–±—Ä–∞–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–º–µ–Ω–∞ –¥–ª—è VK –ø–æ—Å—Ç–µ—Ä–æ–≤ (—Ä–∞–∑—Ä–µ—à–µ–Ω—ã CDN –≤—Ä–æ–¥–µ `mycdn.me`)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `html_entity_decode()` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ `&amp;` –≤ URL
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (–º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**

- `GET /wp-json/gutenberg-blocks/v1/vk-thumbnail?video_id=VIDEO_ID`
- `GET /wp-json/gutenberg-blocks/v1/rutube-thumbnail?video_id=VIDEO_ID`

**–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:**

```json
{
    "thumbnail_url": "https://...",
    "width": 1280,
    "height": 720
}
```

#### 2. `inc/Plugin.php`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ö—É–∫ `wp_enqueue_scripts` –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è `pluign.js` –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å `js/plugin.js` –Ω–∞ `js/pluign.js`

```php
add_action('wp_enqueue_scripts', __CLASS__ . '::gutenbergBlocksExternalLibraries');
```

---

### Frontend JavaScript

#### `includes/js/pluign.js`

**–û–ø–∏—Å–∞–Ω–∏–µ:** JavaScript —Ñ–∏–∫—Å –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è `target="_blank"` —É GLightbox —Å—Å—ã–ª–æ–∫ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ.

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

1. –ü–æ–∏—Å–∫ –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫ —Å `data-glightbox`
2. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —ç—Ç–æ iframe/video —Å—Å—ã–ª–∫–∞
3. –£–¥–∞–ª–µ–Ω–∏–µ `target` –∏ `rel` –∞—Ç—Ä–∏–±—É—Ç–æ–≤
4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤ –∫–æ–Ω—Å–æ–ª—å

**–ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:**

- –ü—Ä–∏ `DOMContentLoaded`
- –ü—Ä–∏ `window.load` (—Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 300ms)

**–ö–æ–¥:**

```javascript
function fixGLightboxLinks() {
    const glightboxLinks = document.querySelectorAll('a[data-glightbox]');
    
    glightboxLinks.forEach(link => {
        const glightboxAttr = link.getAttribute('data-glightbox');
        
        if (glightboxAttr && (
            glightboxAttr.includes('type: iframe') ||
            glightboxAttr.includes('video') ||
            // ...
        )) {
            link.removeAttribute('target');
            link.removeAttribute('rel');
            console.log('üîß Fixed GLightbox link:', link.href);
        }
    });
}
```

---

## API –∏ —Ñ—É–Ω–∫—Ü–∏–∏

### REST API Endpoints

#### VK Thumbnail

```
GET /wp-json/gutenberg-blocks/v1/vk-thumbnail
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `video_id` (string, required) - ID –≤–∏–¥–µ–æ VK –≤ —Ñ–æ—Ä–º–∞—Ç–µ `oid=-123&id=456`

**–û—Ç–≤–µ—Ç:**
```json
{
    "thumbnail_url": "https://i.mycdn.me/...",
    "width": 1280,
    "height": 720
}
```

**–û—à–∏–±–∫–∏:**
- `400` - Missing video_id parameter
- `500` - Failed to fetch video data / No thumbnail found

#### Rutube Thumbnail

```
GET /wp-json/gutenberg-blocks/v1/rutube-thumbnail
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `video_id` (string, required) - ID –≤–∏–¥–µ–æ Rutube (—Ö–µ—à)

**–û—Ç–≤–µ—Ç:**
```json
{
    "thumbnail_url": "https://pic.rutubelist.ru/...",
    "width": 1920,
    "height": 1080
}
```

---

### JavaScript Functions

#### `generateVideoId(linkUrl, linkType)`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/blocks/button/save.js`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `linkUrl` (string) - URL –≤–∏–¥–µ–æ
- `linkType` (string) - –¢–∏–ø —Å—Å—ã–ª–∫–∏ ('vkvideo', 'rutube', etc.)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `string` - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –≤ —Ñ–æ—Ä–º–∞—Ç–µ `{type}-{timestamp}-{random}`

**–ü—Ä–∏–º–µ—Ä:**
```javascript
generateVideoId('https://vkvideo.ru/...', 'vkvideo')
// ‚Üí "vkvideo-1733456789012-x8g4k2p1a"
```

---

## –†–µ—à—ë–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ü–æ—Å—Ç–µ—Ä –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ Video Type

**–ü—Ä–∏—á–∏–Ω–∞:** `useEffect` –∏–º–µ–ª —É—Å–ª–æ–≤–∏–µ `!videoPoster.url`, –∫–æ—Ç–æ—Ä–æ–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.

**–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞–Ω–æ —É—Å–ª–æ–≤–∏–µ, –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `videoType`.

```javascript
useEffect(() => {
    if ((videoType === 'vk' || videoType === 'rutube') && !isLoadingPoster) {
        handleAutoLoadPoster();
    }
}, [videoType, videoVkId, videoRutubeId]);
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: VK –ø–æ—Å—Ç–µ—Ä—ã –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å —Å `mycdn.me` (Odnoklassniki)

**–ü—Ä–∏—á–∏–Ω–∞:** VK –∏—Å–ø–æ–ª—å–∑—É–µ—Ç CDN –û–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–æ–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∏–¥–µ–æ.

**–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–º–µ–Ω–∞, —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –ª—é–±—ã–µ CDN.

```php
// –î–µ–∫–æ–¥–∏—Ä—É–µ–º HTML entities (&amp; ‚Üí &)
$thumbnail_url = html_entity_decode($thumbnail_url);
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Rutube –ø–æ—Å—Ç–µ—Ä –Ω–µ –∑–∞–≥—Ä—É–∂–∞–ª—Å—è –¥–ª—è URL —Å `/video/`

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–∞—Ä—Å–µ—Ä –∏—Å–∫–∞–ª —Ç–æ–ª—å–∫–æ `/embed/` –≤ URL.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–æ–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤.

```javascript
if (url.pathname.includes('/embed/')) {
    rutubeId = url.pathname.split('/embed/')[1];
} else if (url.pathname.includes('/video/')) {
    rutubeId = url.pathname.split('/video/')[1].split('/')[0];
}
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: `&amp;` –≤ VK URL –≤—ã–∑—ã–≤–∞–ª 400 –æ—à–∏–±–∫—É

**–ü—Ä–∏—á–∏–Ω–∞:** HTML entities –Ω–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–ª–∏—Å—å –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∑–∞–ø—Ä–æ—Å–∞.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω `html_entity_decode()` –≤ PHP.

```php
$thumbnail_url = html_entity_decode($thumbnail_url);
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 5: Button –±–ª–æ–∫ –æ—Ç–∫—Ä—ã–≤–∞–ª –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É –≤–º–µ—Å—Ç–æ –ª–∞–π—Ç–±–æ–∫—Å–∞

**–ü—Ä–∏—á–∏–Ω–∞:** 
1. WordPress –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–ª `target="_blank"` —á–µ—Ä–µ–∑ `useBlockProps.save()`
2. `data-glightbox="type: iframe"` –Ω–µ —Ä–∞–±–æ—Ç–∞–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä—ã—Ç–æ–≥–æ iframe + —è–∫–æ—Ä–Ω–∞—è —Å—Å—ã–ª–∫–∞ (–∫–∞–∫ –≤ Media –±–ª–æ–∫–µ)
2. JavaScript —Ñ–∏–∫—Å –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è `target="_blank"` –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
3. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤—ã–≤–æ–¥–∞ –±–µ–∑ `useBlockProps.save()` –Ω–∞ `<a>`

**–î–æ:**
```html
<a href="https://vkvideo.ru/..." 
   data-glightbox="type: iframe; width: 90vw; height: 90vh;" 
   target="_blank">
```

**–ü–æ—Å–ª–µ:**
```html
<div id="vkvideo-xxx" style="display:none">
    <iframe src="https://vkvideo.ru/..."></iframe>
</div>
<a href="#vkvideo-xxx" data-glightbox="width: auto;">
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 6: Button –±—ã–ª –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ

**–ü—Ä–∏—á–∏–Ω–∞:** GLightbox –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ.

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// edit.js
const onClickHandler = isEditor ? (e) => {
    e.preventDefault();
    e.stopPropagation();
} : undefined;

data-glightbox={!isEditor && glightboxAttr ? glightboxAttr : undefined}
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 7: –†–∞–∑–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –ø–æ—Å—Ç–µ—Ä–æ–≤ –≤–∏–¥–µ–æ

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ—Å—Ç–µ—Ä—ã –∏–º–µ–ª–∏ —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω `aspect-ratio: 16/9` –≤ CSS **—Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∏–¥–µ–æ** (–∏—Å–ø–æ–ª—å–∑—É—è `:has(.video-play-btn)`).

```scss
figure:has(.video-play-btn) a > img {
    aspect-ratio: 16 / 9;
    object-fit: cover;
}
```

**–í–∞–∂–Ω–æ:** –ù–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –æ–±—ã—á–Ω—ã–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º –≤ Media –±–ª–æ–∫–µ.

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: Media Block —Å –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–æ–π –ø–æ—Å—Ç–µ—Ä–∞ VK

1. –°–æ–∑–¥–∞—Ç—å Media –±–ª–æ–∫
2. –í—ã–±—Ä–∞—Ç—å "Video Type" ‚Üí "VK Video"
3. –í—Å—Ç–∞–≤–∏—Ç—å URL –∏–ª–∏ iframe –∫–æ–¥ VK –≤–∏–¥–µ–æ –≤ –ø–æ–ª–µ "VK Video URL or ID"
4. –ü–æ—Å—Ç–µ—Ä –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ù–∞–∂–∞—Ç—å "Auto-load Poster from Provider" –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ:**

```html
<div class="wp-block-codeweber-blocks-media cwgb-media-block">
    <div id="video-abc123" style="display:none">
        <iframe src="https://vkvideo.ru/video_ext.php?oid=-82217805&id=456243357&hd=2"></iframe>
    </div>
    <figure class="position-relative">
        <a href="#video-abc123" data-glightbox="width: auto;">
            <img src="https://i.mycdn.me/..." alt="Video Title">
            <button type="button" class="video-play-btn">...</button>
        </a>
    </figure>
</div>
```

---

### –ü—Ä–∏–º–µ—Ä 2: Button Block —Å Rutube –≤–∏–¥–µ–æ

1. –°–æ–∑–¥–∞—Ç—å Button –±–ª–æ–∫
2. –í —Å–∞–π–¥–±–∞—Ä–µ –≤—ã–±—Ä–∞—Ç—å "Link Type" ‚Üí "Rutube"
3. –í—Å—Ç–∞–≤–∏—Ç—å Rutube URL –≤ –ø–æ–ª–µ "Rutube Video URL or ID"
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å—Ç–∏–ª—å –∫–Ω–æ–ø–∫–∏
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Å—Ç

**–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ:**

```html
<div id="rutube-1733456789012-x8g4k2p1a" style="display:none">
    <iframe src="https://rutube.ru/play/embed/699bbd7d...?autoplay=1"></iframe>
</div>
<a href="#rutube-1733456789012-x8g4k2p1a" 
   class="btn btn-primary" 
   data-glightbox="width: auto;">
    <span class="button-content">Watch Video</span>
</a>
```

---

### –ü—Ä–∏–º–µ—Ä 3: –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–µ—Ä–æ–≤

```javascript
import { parseVKVideoURL, parseRutubeVideoURL } from '../utilities/videoUrlParsers';

// VK
const vkEmbed = parseVKVideoURL(
    '<iframe src="https://vkvideo.ru/video_ext.php?oid=-123&id=456"></iframe>',
    true // for lightbox
);
console.log(vkEmbed);
// ‚Üí "https://vkvideo.ru/video_ext.php?oid=-123&id=456&hd=2&autoplay=1&allowFullscreen=true&fullscreen=true"

// Rutube
const rutubeEmbed = parseRutubeVideoURL('699bbd7d...', true);
console.log(rutubeEmbed);
// ‚Üí "https://rutube.ru/play/embed/699bbd7d...?autoplay=1"
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### Media Block

- [ ] VK –≤–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ iframe –∫–æ–¥–∞
- [ ] VK –≤–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–∏
- [ ] VK –≤–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ ID —Ñ–æ—Ä–º–∞—Ç–∞
- [ ] Rutube –≤–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ `/video/` URL
- [ ] Rutube –≤–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ `/embed/` URL
- [ ] –ü–æ—Å—Ç–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ Video Type
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–µ—Ä–∞..." –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- [ ] –ö–Ω–æ–ø–∫–∞ "Auto-load Poster" –∏–º–µ–µ—Ç –æ—Ç—Å—Ç—É–ø 15px —Å–Ω–∏–∑—É
- [ ] –í—Å–µ –ø–æ—Å—Ç–µ—Ä—ã –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –≤—ã—Å–æ—Ç—É (16:9)
- [ ] –í–∏–¥–µ–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –ª–∞–π—Ç–±–æ–∫—Å–µ –ø–æ –∫–ª–∏–∫—É

#### Button Block

- [ ] VK –∫–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞—ë—Ç —Å–∫—Ä—ã—Ç—ã–π iframe
- [ ] Rutube –∫–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞—ë—Ç —Å–∫—Ä—ã—Ç—ã–π iframe
- [ ] –°—Å—ã–ª–∫–∞ –≤–µ–¥—ë—Ç –Ω–∞ —è–∫–æ—Ä—å `#video-xxx`
- [ ] `data-glightbox="width: auto;"` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- [ ] –ù–ï–¢ `target="_blank"` –∏ `rel="noopener"` –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
- [ ] –í–∏–¥–µ–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤ –ª–∞–π—Ç–±–æ–∫—Å–µ
- [ ] –ö–Ω–æ–ø–∫–∞ –Ω–µ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
- [ ] –ü–æ—Å–ª–µ –ø–µ—Ä–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å—Ç–∞ HTML –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

#### JavaScript Fix

- [ ] –ö–æ–Ω—Å–æ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "üîß Fixed GLightbox link"
- [ ] `target` –∏ `rel` —É–¥–∞–ª—è—é—Ç—Å—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
- [ ] –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤

---

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **VK API:** –¢—Ä–µ–±—É–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –≤–∏–¥–µ–æ
2. **Rutube API:** –ú–æ–∂–µ—Ç –∏–º–µ—Ç—å rate limiting
3. **–ü–æ—Å—Ç–µ—Ä—ã:** –ö–∞—á–µ—Å—Ç–≤–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (VK –º–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å –Ω–∏–∑–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ)
4. **Browser caching:** –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω—É–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+F5)

---

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –í–æ–∑–º–æ–∂–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏:

1. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–µ—Ä–æ–≤** –≤ WordPress (transients API)
2. **–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≤–∏–¥–µ–æ** –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –±–µ–∑ –æ—Ç–∫—Ä—ã—Ç–∏—è –ª–∞–π—Ç–±–æ–∫—Å–∞
3. **–ú–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–µ—Ä–æ–≤** –¥–ª—è –≤—Å–µ—Ö –≤–∏–¥–µ–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
4. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º:** Dailymotion, Twitch, TikTok
5. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞** –ø–æ—Å—Ç–µ—Ä–∞ (low/medium/high)
6. **Fallback –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ** –µ—Å–ª–∏ –ø–æ—Å—Ç–µ—Ä –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
7. **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è** —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö

---

## Troubleshooting

### –ü–æ—Å—Ç–µ—Ä –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**

1. –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
2. Network tab - —É—Å–ø–µ—à–µ–Ω –ª–∏ –∑–∞–ø—Ä–æ—Å –∫ REST API
3. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ (–Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ, –Ω–µ —É–¥–∞–ª–µ–Ω–æ)
4. –§–æ—Ä–º–∞—Ç URL (–ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã)

**–õ–æ–≥ –≤ –∫–æ–Ω—Å–æ–ª–∏:**
```
VK videoId not valid - –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç URL
Rutube videoId not valid - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ ID –≤–∏–¥–µ–æ
```

### –í–∏–¥–µ–æ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –ª–∞–π—Ç–±–æ–∫—Å–µ

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**

1. –ü–µ—Ä–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω –ª–∏ –ø–æ—Å—Ç –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. –û—á–∏—â–µ–Ω –ª–∏ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+F5)
3. –ù–µ—Ç –ª–∏ –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
4. –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ `data-glightbox` –≤ HTML
5. –£–¥–∞–ª—ë–Ω –ª–∏ `target="_blank"` (–¥–æ–ª–∂–µ–Ω —É–¥–∞–ª–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### Button –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "üîß Fixed GLightbox link"
2. –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª `pluign.js` –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ Network tab
4. –ü–µ—Ä–µ—Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ—Å—Ç

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `/doc/VIDEO_INTEGRATION.md`  
**API Reference:** `/doc/API_REFERENCE.md`

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 05.12.2024

