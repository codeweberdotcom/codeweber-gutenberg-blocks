# DEV WORKFLOW · Анализ → План → Реализация → Релиз

> ⚠️ **Обязательные правила:**
> - Плагин работает **только** с темой `codeweber` (Bootstrap).
> - Используем стили и компоненты темы. Кастомные стили — только по согласованию.
> - **Gutenberg-компоненты (`@wordpress/components`) НЕ используем** для стилизации на фронте (только в Inspector/Sidebar редактора). Исключения — по согласованию с явным указанием причины.
> - Документация темы: <https://sandbox.elemisthemes.com/index.html>

---

## 1. Анализ
- Подтвердить постановку задачи, затронутые блоки/опции и зависимости (темы, шорткоды, REST API).
- Найти связанную документацию/issue. Любые дополнительные файлы регистрируем в `doc/README.md`.
- Проверить версию WP, PHP и список активных плагинов на стенде — они влияют на API Gutenberg и хуки.

## 2. План
- Определить точки входа:
  - PHP (`plugin.php`, `inc/Plugin.php`, `settings/`),
  - JS (`src/blocks`, `src/components`, `settings/api`),
  - сборочные шаги (`generate-json.js`, `generate-pot.js`).
- Зафиксировать архитектурные решения: где будет храниться состояние, как блок общается с REST/Options API.
- Если правка вносит публичные изменения блока — планируем миграцию (`deprecated` версия, fallback стилей).
- Прописать сценарии теста: редактор, фронт, responsive, RTL (если используется), кеш.

## 3. Реализация
1. Создать ветку и включить `npm run start`.
2. Следовать стандартам:
   - JS/TS: `@wordpress/scripts`, ESLint из пакета, только ESNext.
   - **SCSS/CSS**: в первую очередь использовать классы Bootstrap/темы (`row`, `col-*`, `btn`, `card`, `container` и т.д.). Кастомные стили — с BEM-префиксом `cwgb-` или `codeweber-`.
   - PHP: минимум PHP 7.4, неймспейсы `CodeWeber\Blocks`.
3. При необходимости добавить REST эндпоинты в `settings/api`, зарегистрировать `permission_callback`.
4. Для блоков:
   - использовать `block.json`,
   - настраивать `supports` только необходимыми опциями,
   - разделять `edit.js`, `save.js`, `style.scss`, `editor.scss`,
   - **приоритет — готовые компоненты темы** (карточки, кнопки, сетка). Не дублировать стили, уже существующие в теме.
5. Обновить локализации: `npm run build && node ./generate-pot.js`.

## 4. Тестирование
- **Редактор**: Gutenberg, List View, Inspector Controls, отключение/включение блоков.
- **Фронт**: классическая страница, шаблон темы CodeWeber, шорткоды/доп. виджеты.
- **Перфоманс**: проверяем, что не грузим лишние ассеты (enqueue только при наличии блока на странице).
- **Мультисайт (если доступен)**: убедиться, что опции не пишутся в `wp_options`, когда нужны `blog_options`.
- Зафиксировать результаты и вложить скриншоты в PR.

## 5. Документация
- Обновить соответствующий раздел в `doc/` (или добавить новый).
- Дополнить комментарии в коде (только для сложной логики).
- Если блок получил новые атрибуты/миграции — описать это в `GUTENBERG_BLOCK_STANDARDS.md`.

## 6. Релиз/Передача
- `npm run lint:js && npm run lint:css && npm run build`.
- Убедиться, что `build/` обновлён и находится под версионным контролем.
- Обновить changelog (если проект его ведёт) и README плагина при пользовательских изменениях.
- Упаковать ZIP (`npm run plugin-zip`) при необходимости, приложить к задаче/релизу.

