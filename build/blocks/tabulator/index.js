(()=>{"use strict";var e,t={708:(e,t,l)=>{const r=window.wp.blocks,o=window.wp.i18n,n=JSON.parse('{"apiVersion":3,"name":"codeweber-blocks/tabulator","version":"0.1.0","title":"Tabulator","category":"codeweber-gutenberg-elements","icon":"editor-table","description":"Interactive Tabulator table from Documents (CSV/XLS/XLSX). Supports sorting, filtering, resizable columns.","keywords":["tabulator","table","spreadsheet","data","documents"],"supports":{"html":false,"customClassName":true,"anchor":true},"attributes":{"documentId":{"type":"number","default":0},"height":{"type":"string","default":"400px"},"layout":{"type":"string","default":"fitColumns"},"theme":{"type":"string","default":"midnight"},"sortable":{"type":"boolean","default":true},"resizableColumns":{"type":"boolean","default":true},"movableColumns":{"type":"boolean","default":true},"headerFilter":{"type":"boolean","default":true},"columnMinWidth":{"type":"number","default":80},"columnMaxWidth":{"type":"number","default":400},"exportEnabled":{"type":"boolean","default":true}},"textdomain":"codeweber-gutenberg-blocks","editorScript":"file:./index.js","editorStyle":"file:./index.css","style":"file:./style-index.css","render":"file:./render.php"}'),a=window.React,c=window.wp.blockEditor,u=window.wp.element,b=window.wp.data,s=window.wp.apiFetch;var i=l.n(s);const d=window.wp.components,g=({attributes:e,setAttributes:t})=>{const{documentId:l,height:r,layout:n,theme:c,exportEnabled:b,sortable:s,resizableColumns:g,movableColumns:m,headerFilter:h,columnMinWidth:p,columnMaxWidth:w}=e,[_,k]=(0,u.useState)([]),[f,v]=(0,u.useState)(!1);return(0,u.useEffect)(()=>{v(!0),i()({path:"/codeweber-gutenberg-blocks/v1/documents-csv"}).then(e=>{k(Array.isArray(e)?e:[])}).catch(()=>k([])).finally(()=>v(!1))},[]),(0,a.createElement)(a.Fragment,null,(0,a.createElement)(d.PanelBody,{title:(0,o.__)("Data Source","codeweber-gutenberg-blocks"),initialOpen:!0},(0,a.createElement)(d.SelectControl,{label:(0,o.__)("Document (CSV/XLS/XLSX)","codeweber-gutenberg-blocks"),value:String(l||""),options:[{value:"",label:f?(0,o.__)("Loading…","codeweber-gutenberg-blocks"):(0,o.__)("— Select document —","codeweber-gutenberg-blocks")},..._.map(e=>({value:String(e.id),label:e.title}))],disabled:f,onChange:e=>t({documentId:e?parseInt(e,10):0})})),(0,a.createElement)(d.PanelBody,{title:(0,o.__)("Display","codeweber-gutenberg-blocks"),initialOpen:!0},(0,a.createElement)(d.TextControl,{label:(0,o.__)("Height","codeweber-gutenberg-blocks"),value:r,onChange:e=>t({height:e||"400px"}),help:(0,o.__)("e.g. 400px, 50vh","codeweber-gutenberg-blocks")}),(0,a.createElement)(d.SelectControl,{label:(0,o.__)("Layout","codeweber-gutenberg-blocks"),value:n,options:[{value:"fitColumns",label:(0,o.__)("Fit Columns","codeweber-gutenberg-blocks")},{value:"fitData",label:(0,o.__)("Fit Data","codeweber-gutenberg-blocks")},{value:"fitDataFill",label:(0,o.__)("Fit Data Fill","codeweber-gutenberg-blocks")}],onChange:e=>t({layout:e})}),(0,a.createElement)(d.SelectControl,{label:(0,o.__)("Theme","codeweber-gutenberg-blocks"),value:c,options:[{value:"midnight",label:(0,o.__)("Midnight (dark)","codeweber-gutenberg-blocks")},{value:"modern",label:(0,o.__)("Modern","codeweber-gutenberg-blocks")},{value:"default",label:(0,o.__)("Default (light)","codeweber-gutenberg-blocks")}],onChange:e=>t({theme:e})})),(0,a.createElement)(d.PanelBody,{title:(0,o.__)("Export","codeweber-gutenberg-blocks")},(0,a.createElement)(d.ToggleControl,{label:(0,o.__)("Export buttons","codeweber-gutenberg-blocks"),help:(0,o.__)("Show CSV/JSON export buttons above the table","codeweber-gutenberg-blocks"),checked:!1!==b,onChange:e=>t({exportEnabled:e})})),(0,a.createElement)(d.PanelBody,{title:(0,o.__)("Columns","codeweber-gutenberg-blocks")},(0,a.createElement)(d.ToggleControl,{label:(0,o.__)("Sortable","codeweber-gutenberg-blocks"),help:(0,o.__)("Allow sorting by clicking column header","codeweber-gutenberg-blocks"),checked:s,onChange:e=>t({sortable:e})}),(0,a.createElement)(d.ToggleControl,{label:(0,o.__)("Resizable columns","codeweber-gutenberg-blocks"),checked:g,onChange:e=>t({resizableColumns:e})}),(0,a.createElement)(d.ToggleControl,{label:(0,o.__)("Movable columns","codeweber-gutenberg-blocks"),help:(0,o.__)("Allow drag to reorder columns","codeweber-gutenberg-blocks"),checked:m,onChange:e=>t({movableColumns:e})}),(0,a.createElement)(d.ToggleControl,{label:(0,o.__)("Header filter","codeweber-gutenberg-blocks"),help:(0,o.__)("Search/filter input in column headers","codeweber-gutenberg-blocks"),checked:h,onChange:e=>t({headerFilter:e})}),(0,a.createElement)(d.RangeControl,{label:(0,o.__)("Min column width (px)","codeweber-gutenberg-blocks"),value:p,onChange:e=>t({columnMinWidth:e}),min:40,max:200,step:10}),(0,a.createElement)(d.RangeControl,{label:(0,o.__)("Max column width (px)","codeweber-gutenberg-blocks"),value:w,onChange:e=>t({columnMaxWidth:e}),min:0,max:800,step:50})))},m={midnight:"tabulator_midnight.min.css",modern:"tabulator_modern.min.css",default:"tabulator.min.css"};(0,r.registerBlockType)(n,{edit:({attributes:e,setAttributes:t,clientId:l})=>{const{documentId:r,height:n,layout:s,theme:d,exportEnabled:h,sortable:p,resizableColumns:w,movableColumns:_,headerFilter:k,columnMinWidth:f,columnMaxWidth:v}=e,y=(0,b.useSelect)(e=>e("core/block-editor")?.getSelectedBlockClientId?.(),[]),C=(0,u.useRef)(null),E=(0,u.useRef)(null),[S,x]=(0,u.useState)(!1),[T,F]=(0,u.useState)(null),[O,I]=(0,u.useState)(null);(0,u.useEffect)(()=>{if(y!==l)return;const e=window.codeweberBlocksData?.pluginUrl||"";if(!e)return;const t=e+"assets/vendor/tabulator/"+(m[d]||m.midnight);let r=document.getElementById("tabulator-editor-theme");return r?r.href=t:(r=document.createElement("link"),r.id="tabulator-editor-theme",r.rel="stylesheet",r.href=t,document.head.appendChild(r)),()=>{}},[l,y,d]),(0,u.useEffect)(()=>{if(!r)return x(!1),F(null),void I(null);x(!0),F(null),I(null),i()({path:`/codeweber-gutenberg-blocks/v1/documents/${r}/csv`}).then(e=>{F(null),I(e)}).catch(e=>{F(e?.message||(0,o.__)("Error loading data","codeweber-gutenberg-blocks")),I(null)}).finally(()=>x(!1))},[r]),(0,u.useEffect)(()=>{if(!O||!C.current)return;if(!O.rows||0===O.rows.length)return;const e=window.codeweberBlocksData?.pluginUrl||"",t=()=>{if(void 0===window.Tabulator)return!1;const e=C.current;if(!e)return!1;const t=O.rows[0],l=O.rows.slice(1),r=f||80,a=v||0,c=t.map((e,t)=>{const l={title:String(e||"Col"+(t+1)),field:"col"+t,minWidth:r,resizable:!1!==w,headerSort:!1!==p,formatter:"html"};return a>0&&(l.maxWidth=a),k&&(l.headerFilter="input",l.headerFilterPlaceholder=(0,o.__)("Search…","codeweber-gutenberg-blocks")),l}),u=l.map(e=>{const t={};return e.forEach((e,l)=>t["col"+l]=e),t});return E.current&&(E.current.destroy(),E.current=null),E.current=new window.Tabulator(e,{data:u,columns:c,layout:s||"fitColumns",height:n||"400px",resizableColumnFit:!0,movableColumns:!1!==_}),!0};if(t())return()=>{if(E.current){try{E.current.destroy()}catch(e){}E.current=null}};if(e&&void 0===window.Tabulator){const l=document.createElement("script");return l.src=e+"assets/vendor/tabulator/tabulator.min.js",l.onload=()=>{t()},document.head.appendChild(l),()=>{if(l.remove(),E.current){try{E.current.destroy()}catch(e){}E.current=null}}}let l=0;const r=setInterval(()=>{(t()||++l>=50)&&clearInterval(r)},100);return()=>{if(clearInterval(r),E.current){try{E.current.destroy()}catch(e){}E.current=null}}},[O,n,s,p,w,_,k,f,v]);const M=(0,c.useBlockProps)({className:"wp-block-codeweber-blocks-tabulator tabulator-block-editor"});return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(c.InspectorControls,null,(0,a.createElement)(g,{attributes:e,setAttributes:t})),(0,a.createElement)("div",{...M},r?S?(0,a.createElement)("div",{className:"tabulator-block-loading"},(0,a.createElement)("p",null,(0,o.__)("Loading…","codeweber-gutenberg-blocks"))):T?(0,a.createElement)("div",{className:"tabulator-block-error"},(0,a.createElement)("p",null,T)):O?.rows?.length?(0,a.createElement)(a.Fragment,null,!1!==h&&(0,a.createElement)("div",{className:"cw-tabulator-export"},(0,a.createElement)("button",{type:"button",className:"btn has-ripple btn-primary btn-xs",onClick:()=>E.current?.download("csv","data.csv")},"CSV"),(0,a.createElement)("button",{type:"button",className:"btn has-ripple btn-primary btn-xs",onClick:()=>E.current?.download("json","data.json")},"JSON")),(0,a.createElement)("div",{ref:C,className:"tabulator-editor-container",style:{minHeight:n||"400px"}})):(0,a.createElement)("div",{className:"tabulator-block-empty"},(0,a.createElement)("p",null,(0,o.__)("No data in document.","codeweber-gutenberg-blocks"))):(0,a.createElement)("div",{className:"tabulator-block-placeholder"},(0,a.createElement)("p",null,(0,o.__)("Select a document (CSV/XLS/XLSX) in the sidebar.","codeweber-gutenberg-blocks")))))},save:()=>null,title:(0,o.__)("Tabulator","codeweber-gutenberg-blocks"),description:(0,o.__)("Interactive Tabulator table from Documents (CSV/XLS/XLSX). Supports sorting, filtering, resizable columns.","codeweber-gutenberg-blocks"),keywords:[(0,o.__)("tabulator","codeweber-gutenberg-blocks"),(0,o.__)("table","codeweber-gutenberg-blocks"),(0,o.__)("spreadsheet","codeweber-gutenberg-blocks"),(0,o.__)("data","codeweber-gutenberg-blocks")]})}},l={};function r(e){var o=l[e];if(void 0!==o)return o.exports;var n=l[e]={exports:{}};return t[e](n,n.exports,r),n.exports}r.m=t,e=[],r.O=(t,l,o,n)=>{if(!l){var a=1/0;for(s=0;s<e.length;s++){for(var[l,o,n]=e[s],c=!0,u=0;u<l.length;u++)(!1&n||a>=n)&&Object.keys(r.O).every(e=>r.O[e](l[u]))?l.splice(u--,1):(c=!1,n<a&&(a=n));if(c){e.splice(s--,1);var b=o();void 0!==b&&(t=b)}}return t}n=n||0;for(var s=e.length;s>0&&e[s-1][2]>n;s--)e[s]=e[s-1];e[s]=[l,o,n]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var l in t)r.o(t,l)&&!r.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={5347:0,6283:0};r.O.j=t=>0===e[t];var t=(t,l)=>{var o,n,[a,c,u]=l,b=0;if(a.some(t=>0!==e[t])){for(o in c)r.o(c,o)&&(r.m[o]=c[o]);if(u)var s=u(r)}for(t&&t(l);b<a.length;b++)n=a[b],r.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return r.O(s)},l=globalThis.webpackChunkcodeweber_gutenberg_blocks=globalThis.webpackChunkcodeweber_gutenberg_blocks||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))})();var o=r.O(void 0,[6283],()=>r(708));o=r.O(o)})();